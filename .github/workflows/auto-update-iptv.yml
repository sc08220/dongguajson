name: 自动更新IPTV.m3u文件

# 定时执行（UTC时间16点 = 北京时间0点）+ 允许手动触发
on:
  schedule:
    - cron: '0 16 * * *'  # 每天北京时间0点执行，想改时间看下面说明
  workflow_dispatch:  # 手动触发开关

# 赋予提交代码的权限
permissions:
  contents: write

jobs:
  update-iptv:
    runs-on: ubuntu-latest  # 使用Ubuntu系统运行

    steps:
      # 第一步：把仓库代码拉到执行环境中
      - name: 检出仓库代码
        uses: actions/checkout@v4

      # 第二步：确保curl工具可用（Ubuntu默认有，保险起见）
      - name: 安装curl依赖
        run: sudo apt-get update && sudo apt-get install -y curl

      # 第三步：执行下载脚本
      - name: 运行下载脚本
        run: bash ./download-iptv.sh

      # 第四步：把更新后的文件提交回仓库
      - name: 提交并推送更新
        run: |
          # 配置git用户信息（必须，否则无法提交）
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # 检查IPTV.m3u是否有变化
          if git status | grep -q "IPTV.m3u"; then
              git add IPTV.m3u
              git commit -m "Auto update IPTV.m3u $(date +'%Y-%m-%d %H:%M:%S')"
              git push
              echo "文件已更新并推送到仓库"
          else
              echo "文件无变化，无需提交"
          fi
